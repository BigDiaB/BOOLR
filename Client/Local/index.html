<meta charset="utf-8">

<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="../popup.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<title>PWS // SANDBOX MODE</title>

<canvas id="canvas" tabindex="1"></canvas>

<!-- Console -->
<div id="console">
    <ul id="output"></ul>
    <input id="input" spellcheck="false">
</div>

<!-- Component toolbar -->
<div id="toolbar">
    <div class="slot">I/O</div>
    <div class="slot" onmousedown="select(NOT)">!</div>
    <div class="slot" onmousedown="select(AND)">&</div>
    <div class="slot" onmousedown="select(OR)">|</div>
    <div class="slot" onmousedown="select(XOR)">^</div>
    <div class="slot" onmousedown="popup.custom_component.show()">?</div>
    <div class="slot" onmousedown="popup.component_list.show()">...</div>

    <div id="message"></div>

    <ul id="list" tabindex="1" style="display: none">
        <li onclick="select(Input)">Input</li>
        <li onclick="select(Output)">Output</li>
        <li onclick="select(Constant)">Constant</li>
        <li onclick="select(Clock)">Clock</li>
        <li>LED</li>
    </ul>
</div>

<!-- Credits -->
<div id="credits">
    <span id="version" onclick="popup.whatsnew.show()">PWS v0.1.58</span>
    <button onclick="popup.settings.show()" class="material-icons">settings</button>
    <button onclick="popup.info.show()" class="material-icons">help</button>
</div>

<!-- Debug info -->
<div id="debugInfo"></div>

<!-- Component info -->
<div id="componentInfo"></div>

<!-- Context menu -->
<ul id="contextMenu" tabindex="1" oncontextmenu="return false" style="display: none;"></ul>

<!-- Overlay -->
<div id="overlay"></div>

<!-- Pop-ups -->
<div class="popup" id="confirm">
    <h1></h1>
    <p></p>
    <button class="ok">OK</button>
    <button class="cancel">Cancel</button>
</div>

<div class="popup" id="prompt">
    <h1>Prompt</h1>
    <p>Text</p>
    <input spellcheck="false">
    <button class="ok">OK</button>
    <button class="cancel">Cancel</button>
</div>

<div class="popup" id="whatsnew">
    <h1>Update 0.1.58</h1>
    <ul>
        <li><span style="font-family: 'Edwardian Script ITC', Kunstler Script; font-size: 30px">Nieuw design</span></li>
        <li>Volledig asynchrone component updates</li>
        <li>Vernieuwd hoofdmenu</li>
        <li>Clipbord blijft opgeslagen in lokale opslag</li>
        <li>Componenten selecteren met Tab of middelste muisknop</li>
        <li>Een aantal commando's toegevoegd (probeer 'help' commando om alle commando's te zien)</li>
        <li>Draden worden meegetrokken als componenten worden verplaatst</li>
        <li>Handig: meerdere componenten tegelijk met elkaar verbinden in een beweging</li>
        <li>Nieuwe pop-up menuutjes (zoals deze)</li>
        <li><b>Zoom-bug opgelost</b></li>
        <li>Heel veel insecten eruit gehaald en verbeteringen in de achtergrond</li>
    </ul>
    <p style="color: darkred">Let op! Als je dit programma via GitHub gedownload hebt, werkt het nog niet om via het hoofdmenu projecten vanaf bestanden te openen. Je kunt wel een bestand openen via 'Sandbox mode' > Ctrl + O</p>
    <br>
    <button class="ok">Close</button>
</div>

<div class="popup" id="custom_component">
    <h1>Create custom component</h1>
    <textarea spellcheck="false">
class Component {
    constructor() {

    }
}
    </textarea>
    <br>
    <button class="ok" disabled="true">OK</button>
    <button class="cancel">Cancel</button>
</div>

<div class="popup" id="component_list">
    <h1>Component list</h1>
    <p style="font-family: 'Roboto'; font-size: 20px; opacity: .5">Not yet available</p>
    <button class="ok">Close</button>
</div>

<div class="popup" id="settings">
    <h1>Settings</h1>
    <ul>
        <li>
            Scroll animation<label class="switch"><input type="checkbox"><div class="slider"></div></label>
        </li>
        <li>
            Zoom animation<label class="switch"><input type="checkbox"><div class="slider"></div></label>
        </li>
        <li><button onclick="popup.confirm.show('Clear localStorage','Are you sure you want to clear all local stored data?', () => { localStorage.pws = ''; location.reload() })">Clear localStorage</button></li>
    </ul>
    <button class="ok">OK</button>
    <button class="cancel">Cancel</button>
</div>

<div class="popup" id="info">
    <h1>Info</h1>
    <button class="ok">Close</button>
</div>

<!-- Open files -->
<input id="open_file" type="file" accept=".dat" style="display: none">

<script>
    document.getElementById("open_file").onchange = function(e) {
        const input = e.target;

        const reader = new FileReader;
        reader.onload = function() {
            components = [];
            parse(reader.result);
        }
        reader.readAsText(input.files[0]);
    }
</script>

<!-- Scrippies -->
<script src="main.js"></script>
<script src="ticker.js"></script>
<script src="keys.js"></script>
<script src="console.js"></script>
<script src="toolbar.js"></script>
<script src="components.js"></script>
<script src="misc.js"></script>
<script src="debug.js"></script>
<script src="contextmenu.js"></script>
<script src="componentInfo.js"></script>
<script src="../popup.js"></script>
<script src="stringifier.js"></script>
<script>
    "use strict";

    const VERSION = "0.1.79";
    document.getElementById("version").innerHTML = "PWS v" + VERSION;

    let data;
    if(localStorage.pws) data = JSON.parse(localStorage.pws);
    else data = {};

    if(data.settings) settings = data.settings;
    if(data.clipbord) clipbord = data.clipbord;
    if(data.version != VERSION) { popup.whatsnew.show() }

    c.focus();

    updateDebugInfo();
    setInterval(updateDebugInfo,500);

    draw();  // 'draw' loop starten
    //tick(); // 'tick' loop starten
</script>
